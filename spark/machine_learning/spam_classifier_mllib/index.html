<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66582-32"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66582-32');
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Simple Spam Classfication in MLlib" />
<meta property="og:description" content="import findspark findspark.init() import pyspark sc = pyspark.SparkContext() Borrowed, wholesale, from Learning Spark, we&rsquo;re going to do a simple spam classifier to determine if an email is authentic or not. This post is less about the approach, and more about examining the building blocks of the MLlib pipeline. But first&hellip;
The Data Each line represents a separate email. The dataset came pre-sorted by spam/not-spam, we&rsquo;re going split over words then do some fancy Spark pre-processing." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://napsterinblue.github.io/notes/spark/machine_learning/spam_classifier_mllib/" />



<meta property="article:published_time" content="2018-06-12T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2018-06-12T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Simple Spam Classfication in MLlib"/>
<meta name="twitter:description" content="import findspark findspark.init() import pyspark sc = pyspark.SparkContext() Borrowed, wholesale, from Learning Spark, we&rsquo;re going to do a simple spam classifier to determine if an email is authentic or not. This post is less about the approach, and more about examining the building blocks of the MLlib pipeline. But first&hellip;
The Data Each line represents a separate email. The dataset came pre-sorted by spam/not-spam, we&rsquo;re going split over words then do some fancy Spark pre-processing."/>
<meta name="generator" content="Hugo 0.40.3" />

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Simple Spam Classfication in MLlib",
  "url": "https://napsterinblue.github.io/notes/spark/machine_learning/spam_classifier_mllib/",
  "wordCount": "571",
  "datePublished": "2018-06-12T00:00:00&#43;00:00",
  "dateModified": "2018-06-12T00:00:00&#43;00:00",
  "author": {
    "@type": "Person",
    "name": ""
  }
}
</script> 

    <title>Simple Spam Classfication in MLlib</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://napsterinblue.github.io/notes/css/custom.css" rel="stylesheet">
    <link href="https://napsterinblue.github.io/notes/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">

    <link href="" rel="alternate" type="application/rss+xml" title="Data Science Notes" />

    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="https://napsterinblue.github.io">Movies, Metrics, Musings</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="nav navbar-nav">
                    <li><a href="https://napsterinblue.github.io/pages/about.html" title="About">About</a></li>
                    <li><a href="https://napsterinblue.github.io/archives.html" title="Archive">Archive</a></li>
                    <li><a href="https://napsterinblue.github.io/pages/resources.html" title="Resources">Resources</a></li>
                    <li><a href="https://napsterinblue.github.io/notes/" title="Notes">My Notes</a></li>

                </ul>
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                 


<article>
  <div class="technical_note">
  <header>
    <h1 class="technical_note_title">Simple Spam Classfication in MLlib</h1>
    <div class="technical_note_date">
      <time datetime=" 2018-06-12T00:00:00Z "> 12 Jun 2018</time>
    </div>
  </header>
  <div class="content">
  

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">findspark</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">pyspark</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">()</span></code></pre></div>
<p>Borrowed, wholesale, from Learning Spark, we&rsquo;re going to do a simple spam classifier to determine if an email is authentic or not. This post is less about the approach, and more about examining the building blocks of the <code>MLlib</code> pipeline. But first&hellip;</p>

<h2 id="the-data">The Data</h2>

<p>Each line represents a separate email. The dataset came pre-sorted by spam/not-spam, we&rsquo;re going split over words then do some fancy Spark pre-processing.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">spam</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s1">&#39;../data/spam.txt&#39;</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">!</span><span class="nb">type</span> <span class="o">..</span>\<span class="n">data</span>\<span class="n">spam</span><span class="o">.</span><span class="n">txt</span></code></pre></div>
<pre><code>Dear sir, I am a Prince in a far kingdom you have not heard of.  I want to send you money via wire transfer so please ...
Get Viagra real cheap!  Send money right away to ...
Oh my gosh you can be really strong too with these drugs found in the rainforest. Get them cheap right now ...
YOUR COMPUTER HAS BEEN INFECTED!  YOU MUST RESET YOUR PASSWORD.  Reply to this email with your password and SSN ...
THIS IS NOT A SCAM!  Send money and get access to awesome stuff really cheap and never have to ...
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># ostensibly &#39;good spam&#39;</span>
<span class="n">ham</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s1">&#39;../data/ham.txt&#39;</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">!</span><span class="nb">type</span> <span class="o">..</span>\<span class="n">data</span>\<span class="n">ham</span><span class="o">.</span><span class="n">txt</span></code></pre></div>
<pre><code>Dear Spark Learner, Thanks so much for attending the Spark Summit 2014!  Check out videos of talks from the summit at ...
Hi Mom, Apologies for being late about emailing and forgetting to send you the package.  I hope you and bro have been ...
Wow, hey Fred, just heard about the Spark petabyte sort.  I think we need to take time to try it out immediately ...
Hi Spark user list, This is my first question to this list, so thanks in advance for your help!  I tried running ...
Thanks Tom for your email.  I need to refer you to Alice for this one.  I haven't yet figured out that part either ...
Good job yesterday!  I was attending your talk, and really enjoyed it.  I want to try out GraphX ...
Summit demo got whoops from audience!  Had to let you know. --Joe
</code></pre>

<h2 id="mllib-tools">MLlib Tools</h2>

<p><code>MLlib</code> works at the <code>RDD</code> level.</p>

<h3 id="tf-term-frequency">TF, Term Frequency</h3>

<p>The <code>HashingTF</code> object we&rsquo;re about to use deserves a whole post in itself, but for now we&rsquo;ll hand-wave and say that it provides a way to take strings and convert them to a numeric representation.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyspark.mllib.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span></code></pre></div>
<p>We could get away with making an arbitrarily-large feature space, but let&rsquo;s look at how many distinct words there are in the dataset.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">uniqueWords</span> <span class="o">=</span> <span class="p">(</span><span class="n">spam</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
                              <span class="o">.</span><span class="n">distinct</span><span class="p">())</span>

<span class="n">uniqueWords</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></code></pre></div>
<pre><code>154
</code></pre>

<p>And then truncate down to 100 features for roundness.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">tf</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">numFeatures</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code></pre></div>
<p>And continue to update <code>tf</code> based on what values it sees in <code>spam</code> and <code>ham</code></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">spamFeatures</span> <span class="o">=</span> <span class="n">spam</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">email</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">hamFeatures</span> <span class="o">=</span> <span class="n">ham</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">email</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)))</span></code></pre></div>
<h3 id="label-datasets">Label Datasets</h3>

<p>And this just standard modeling fare, creating a <code>y</code> for each <code>X</code>, but now with the <code>map</code> function.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyspark.mllib.regression</span> <span class="kn">import</span> <span class="n">LabeledPoint</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">positiveExamples</span> <span class="o">=</span> <span class="n">spamFeatures</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">features</span><span class="p">:</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">features</span><span class="p">))</span>
<span class="n">negativeExamples</span> <span class="o">=</span> <span class="n">hamFeatures</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">features</span><span class="p">:</span> <span class="n">LabeledPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">features</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">trainingData</span> <span class="o">=</span> <span class="n">positiveExamples</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">negativeExamples</span><span class="p">)</span></code></pre></div>
<p>And we <code>cache</code> the data, because we&rsquo;ll be doing a ton of iterating when we do our Machine Learning routine.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">trainingData</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span></code></pre></div>
<pre><code>UnionRDD[430] at union at &lt;unknown&gt;:0
</code></pre>

<h3 id="train-model">Train Model</h3>

<p>If that&rsquo;s looks like <code>sklearn</code>, that&rsquo;s on purpose.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyspark.mllib.classification</span> <span class="kn">import</span> <span class="n">LogisticRegressionWithSGD</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegressionWithSGD</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span></code></pre></div>
<h3 id="evaluate-model">Evaluate Model</h3>

<p>Finally, we&rsquo;ll make some fake email strings to see how accurate our classifier proves to be.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">posTest</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&#34;Congrats, you won! Send me money!&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">negTest</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&#34;Hey, yeah. I think you&#39;re right about this one.&#34;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">posTest</span><span class="p">)</span></code></pre></div>
<pre><code>1
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">negTest</span><span class="p">)</span></code></pre></div>
<pre><code>0
</code></pre>

</div>
  <aside>
      <div class="bug_reporting">
          <h4>Find an error or bug?</h4>
          <p>Everything on this site is available on GitHub. Head to <a href='https://github.com/napsterinblue/notes/issues/new'>and submit a suggested change</a>. You can also message me directly on <a href='https://twitter.com/napsterinblue'>Twitter</a>.</p>
      </div>
      </aside>

    </div>
</article>




            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">This project contains 185 pages and is available on <a href="https://github.com/napsterinblue/notes">GitHub</a>. Copyright &copy; NapsterInBlue, <time datetime="2018">2018</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>
